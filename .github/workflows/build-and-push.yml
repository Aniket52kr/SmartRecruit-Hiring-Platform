name: Build and Push Docker Images

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

  jobs: 
    build-and-push:
      runs-on: ubuntu-latest
      permissions:
        contents: read
        packages: write
        id-token: write

      steps:
        - name: checkout
          uses: actions/checkout@v4

        - name: set up Docker Buildx
          uses: docker/setup-buildx-action@v3

        - name: Login to Docker Hub
          uses: docker/login-action@v2
          with: 
            username: ${{ secrets.DOCKER_USERNAME }}
            password: ${{ secrets.DOCKER_PASSWORD }}

        - name: Build and Push Backend
          uses: docker/build-push-action@v6
          with: 
            context: ./backend
            push: true
            tags: 
              - ${{ secrets.DOCKER_USERNAME }}/smartrecruit:backend
              - ${{ secrets.DOCKER_USERNAME }}/smartrecruit:backend-${{ github.sha }}

        - name: Build and Push Frontend
          uses: docker/build-push-action@v6
          with: 
            context: ./frontend 
            push: true
            tags: 
              - ${{ secrets.DOCKER_USERNAME }}/smartrecruit:frontend
              - ${{ secrets.DOCKER_USERNAME }}/smartrecruit:frontend-${{ github.sha }}
